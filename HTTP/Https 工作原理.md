### 一、什么是 HTTPS

> HTTPS 是在 HTTP 上建立 SSL 加密层，并对传输数据进行加密

HTTPS 主要作用是：

1. 对数据进行加密，并建立一个信息安全通道，来保证传输过程中的数据安全
2. 对网站服务器进行真实身份认证



### 二、为什么需要 HTTPS

HTTP 协议存在的哪些问题：

- 通信使用明文（不加密），内容可能被窃听
  - 可能导致数据泄露、数据篡改、流量劫持、钓鱼攻击的等安全问题
- 无法证明报文的完整性，所以可能遭篡改
  - 没有任何办法确认，发出的请求/响应和接收到的请求/响应是前后相同的
- 不验证通信方的身份，因此有可能遭遇伪装
  - HTTP 协议中的请求和响应不会对通信方进行确认



HTTPS 协议的优势：

- 数据隐私性：内容经过对称加密，每个连接生成一个唯一的加密密钥
- 数据完整性：内容传输经过完整性校验
- 身份认证：第三方无法伪造服务端（客户端）身份



### 三、加密 / 数字签名 / 数字证书

#### 3.1、解决内容可能被窃听的问题 -- 加密

TLS/SSL 协议的功能实现主要依赖于三类基本算法：散列函数 、对称加密和非对称加密

- **对称加密**算法采用协商的密钥对数据加密
  - 加密和解密同用一个密钥

- **非对称加密**算法实现身份认证和密钥协商
  - 公开密钥加密使用一对非对称的密钥。一把叫做私有密钥，另一把叫做公开密钥
- **散列函数**验证信息的完整性

**对称加密+非对称加密（HTTPS 采用这种方式）**

- 在交换密钥环节使用非对称加密方式，之后的建立通信交换报文阶段则使用对称加密方式

#### 3.2、解决报文可能遭篡改问题 -- 数字签名

**数字签名有两种功效**：

- 能确定消息确实是由发送方签名并发出来的，因为别人假冒不了发送方的签名。
- 数字签名能确定消息的完整性，证明数据是否未被篡改过。

#### 3.3、解决通信方身份可能被伪装的问题——数字证书

数字证书认证机构处于客户端与服务器双方都可信赖的第三方机构的立场上



### 四、 HTTPS 工作流程

1. Client 发起一个 HTTPS（比如`https://juejin.im/user/5a9a9cdcf265da238b7d771c`）的请求，根据 RFC2818 的规定，Client 知道需要连接 Server 的 443（默认）端口。

2. Server 把事先配置好的公钥证书（public key certificate）返回给客户端。

3. Client 验证公钥证书：比如是否在有效期内，证书的用途是不是匹配 Client 请求的站点，是不是在 CRL 吊销列表里面，它的上一级证书是否有效，这是一个递归的过程，直到验证到根证书（操作系统内置的 Root 证书或者 Client 内置的 Root 证书）。如果验证通过则继续，不通过则显示警告信息。

4. Client 使用伪随机数生成器生成加密所使用的对称密钥，然后用证书的公钥加密这个对称密钥，发给 Server。

5. Server 使用自己的私钥（private key）解密这个消息，得到对称密钥。至此，Client 和 Server 双方都持有了相同的对称密钥。

6. Server 使用对称密钥加密“明文内容A”，发送给 Client。

7. Client 使用对称密钥解密响应的密文，得到“明文内容 A”。

8. Client 再次发起 HTTPS 的请求，使用对称密钥加密请求的“明文内容 B”，然后 Server 使用对称密钥解密密文，得到“明文内容 B”。



### 五、HTTP 与 HTTPS 的区别

- HTTP 超文本传输协议，信息是明文传输 ，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全
- HTTPS 需要用到 CA 证书，而 HTTP 不用;
- HTTPS 标准端口 443，HTTP标准端口 80;
- HTTPS 基于传输层，HTTP 基于应用层;

